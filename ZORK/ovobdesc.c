/* defines, enums ------------------------------------------------------------- */
#define NUM_OBJECTS  80

#define INSIDE  2048

#define O_YOU 1
#define O_GARLIC 26
#define O_LAMP 36
#define O_CANDLES 42

/*object bit flags*/

#define PROP_OPENABLE        1
#define PROP_OPEN            2
#define PROP_LIT             4
#define PROP_NODESC          8
#define PROP_NOTTAKEABLE    16
#define PROP_MOVEDDESC      32  /* set when object is first taken */
#define PROP_INSIDEDESC     64  /* set for objects that are initially 
					described as inside another object */
#define PROP_SACRED        128  /* set for objects that aren't allowed to be taken by thief */
#define PROP_EVERYWHERE    256
#define PROP_WEAPON        512
#define PROP_ACTOR        1024
#define PROP_TOOL         2048
#define PROP_INFLAMMABLE  4096
#define PROP_SURFACE      8192

/* extern data structures ---------------------------------------------------------- */
struct OBJ_STRUCT
{
  unsigned short init_loc;
  unsigned short loc;
  unsigned short size;
  unsigned short capacity;
  unsigned short order;
  unsigned short prop;
  unsigned char init_thiefvalue;
  unsigned char thiefvalue;
};
extern struct OBJ_STRUCT Obj[];

extern unsigned char YouAreDead;
extern int TrollDescType;
extern int ThiefDescType; /* 0: default  1: unconscious*/
extern int CyclopsState; /* 0: default  1: hungry  2: thirsty  3: asleep  4: fled*/
extern unsigned char YouAreInBoat;

/* extern functions ---------------------------------------------------------------- */
void PrintCompText(char *comp_text);
void PrintText(char*);
int IsObjVisible(int obj);

void ReturnOverlay1(short);

/* variables ----------------------------------------------------------------------- */

/* code ---------------------------------------------------------------------------- */

void PrintDesc_Ghosts(int desc_flag)
{
  if (desc_flag == 0)
    PrintCompText("\xd0\x6e\x75\x6d\xef\xb6\xdd\xe6\x68\x6f\x73\x74\x73");
  else
  {
    if (YouAreDead == 0)
      PrintCompText("\x85\x77\x61\xc4\xa2\xc2\x75\x67\xde\x81\x67\xaf\x9e\x9a"
"\x62\xbb\xa9\xab\x62\xc4\x65\x76\x69\xea\x73\x70\x69\xf1\x74\x73\xb5\x77\x68"
"\xba\x6a\xf3\xb6\xaf\x86\xb6\xaf\xd1\x6d\x70\x74\xa1\xbd\xeb\xe0\x73\x2e");
  }
  ReturnOverlay1(0);
}

void PrintDesc_Bat(int desc_flag)
{
  if (desc_flag == 0)
    PrintCompText("\xd0\x62\x61\x74");
  else
  {
    if (IsObjVisible(O_GARLIC))
      PrintCompText("\x49\xb4\x81\x63\xd3\xed\xb6\xdd\x80\xda\xe9\xf9\xca\x80"
"\xb3\x65\x69\xf5\x9c\x9a\xd0\xfd\x72\x67\x9e\x76\x61\x6d\x70\x69\xa9\xb0\xaf"
"\xb7\x68\xba\x9a\x6f\x62\x76\x69\xa5\x73\xec\xcc\xac\xad\x67\xd5\x8d\xc0\x6f"
"\x6c\x64\x84\xce\xa1\xe3\x73\x65\x2e");
    else
      PrintCompText("\x41\xcb\xbb\x67\x9e\x76\x61\x6d\x70\x69\xa9\xb0\xaf\xb5"
"\xcd\xb1\x84\x66\xc2\xf9\x81\x63\x65\x69\xf5\xb1\xb5\x73\x77\xe9\x70\xa1\x64"
"\xf2\xb4\xaf\x86\x21");
  }
  ReturnOverlay1(0);
}

void PrintDesc_Troll(int desc_flag)
{
  if (desc_flag == 0)
    PrintCompText("\xd0\x74\xc2\x6c\x6c");
  else
    switch (TrollDescType)
  {
    case 0: PrintCompText("\x41\xe4\xe0\x74\x79\x2d\xd9\x6f\x6b\x84\x74\xc2"
"\xdf\xb5\x62\xf4\xb9\xb2\xce\x9c\xd0\x62\xd9\x6f\x64\xc4\x61\x78\x65\xb5\x62"
"\xd9\x63\x6b\xa1\xe2\xea\x70\xe0\x73\x61\x67\xbe\xae\xf7\x8a\x81\xc2\x6f\x6d\x2e"); break;
    case 1: PrintCompText("\x41\xb4\xf6\x63\xca\x73\x63\x69\xa5\xa1\x74\xc2"
"\xdf\x87\x73\x70\xf4\x77\xcf\xab\xca\x80\xc6\xd9\xd3\xa4\x41\xdf\xeb\xe0\x73"
"\x61\x67\xbe\xae\xf7\x8a\x81\xc2\xe1\xa3\xa9\xae\xfc\x6e\x2e"); break;
    case 2: PrintCompText("\x41\xeb\xaf\xa0\xf0\xe7\xdf\xc4\x62\x61\x62\x62"
"\xf5\x9c\x74\xc2\xdf\x87\xa0\x72\x65\x2e"); break;
    case 3: PrintCompText("\x41\x9f\xc2\xdf\x87\xa0\x72\x65\x2e"); break;
  }
  ReturnOverlay1(0);
}

void PrintDesc_Thief(int desc_flag)
{
  if (desc_flag == 0)
    PrintCompText("\xd0\xa2\x69\x65\x66");
  else
    switch (ThiefDescType)
  {
    case 0: PrintCompText("\x99\xa9\x87\xd0\x73\xfe\x70\x69\x63\x69\xa5\x73"
"\x2d\xd9\x6f\x6b\x84\xa7\x64\x69\x76\x69\x64\x75\xe2\xb5\x68\x6f\x6c\x64\x84"
"\xd0\x62\x61\x67\xb5\xcf\xad\x84\x61\x67\x61\xa7\xc5\xae\xed\xb7\xe2\x6c\xa4"
"\x48\x9e\x9a\xbb\x6d\xd5\xb7\xc7\xde\xd0\x76\x69\x63\x69\xa5\x73\x2d\xd9\x6f"
"\x6b\x84\xc5\x69\xcf\x74\x74\x6f\x2e"); break;
    case 1: PrintCompText("\x99\xa9\x87\xd0\x73\xfe\x70\x69\x63\x69\xa5\x73\x2d"
"\xd9\x6f\x6b\x84\xa7\x64\x69\x76\x69\x64\x75\xe2\xcb\x79\x84\xf6\x63\xca\x73"
"\x63\x69\xa5\xa1\xca\x80\xe6\xc2\xf6\x64\x2e"); break;
  }
  ReturnOverlay1(0);
}

void PrintDesc_Cyclops(int desc_flag)
{
  if (desc_flag == 0)
    PrintCompText("\xd0\x63\x79\x63\xd9\x70\x73");
  else
    switch (CyclopsState)
  {
    case 0: PrintCompText("\x41\xb3\x79\x63\xd9\x70\x73\xb5\x77\x68\xba\xd9\x6f"
"\x6b\xa1\x70\xa9\x70\xbb\xd5\x89\xbf\xa6\x68\xd3\xd6\xa1\x28\x6d\x75\xfa\xcb"
"\xbe\xa1\x6d\xac\x9e\x61\x64\xd7\xe5\xd8\xac\x73\x29\xb5\x62\xd9\x63\x6b\xa1"
"\x81\xc5\x61\x69\x72\xe7\xd6\xa4\x46\xc2\xf9\xce\xa1\xc5\xaf\x9e\xdd\xc0\xbf"
"\x6c\xa2\xb5\x8c\x81\x62\xd9\x6f\x64\xc5\x61\xa7\xa1\xca\x80\xb7\xe2\x6c\x73"
"\xb5\x8f\x67\xaf\xa0\xb6\xa2\xaf\xc0\x9e\x9a\xe3\xa6\xd7\x72\xc4\x66\xf1\xd4"
"\x64\xec\xb5\xa2\xa5\x67\xde\x94\xf5\x6b\xbe\xeb\x65\x6f\x70\x6c\x65\x2e"); break;
    case 1: PrintCompText("\x85\x63\x79\x63\xd9\x70\xa1\x9a\xc5\xad\x64\x84\xa7"
"\x80\xb3\xd3\xed\x72\xb5\x65\x79\x65\x84\x8f\x63\xd9\xd6\xec\xa4\x49\xcc\xca"
"\x27\xa6\xa2\xa7\x6b\xc0\x9e\xf5\x6b\xbe\x86\x20\xd7\x72\xc4\x6d\x75\xfa\xa4"
"\x48\x9e\xd9\x6f\x6b\xa1\x65\x78\x74\xa9\x6d\x65\xec\xc0\xf6\x67\x72\x79\xb5"
"\x65\xd7\xb4\x66\xd3\xa3\xb3\x79\x63\xd9\x70\x73\x2e"); break;
    case 2: PrintCompText("\x85\x63\x79\x63\xd9\x70\x73\xb5\xcd\x76\x84\xbf"
"\xd1\xb4\x81\x68\xff\xeb\x65\x70\xfc\x72\x73\xb5\x61\x70\xfc\xbb\xa1\xbd\xb0"
"\x9e\x67\xe0\x70\x97\xa4\x48\x9a\xd4\x66\xfd\x6d\xd5\x9f\xca\x67\x75\x9e\x70"
"\xc2\x74\x72\x75\xe8\xa1\x66\xc2\xf9\xce\xa1\x6d\xad\x2d\x73\x69\x7a\xd5\xee"
"\xa5\x74\x68\x2e"); break;
    case 3: PrintCompText("\x85\x63\x79\x63\xd9\x70\xa1\x9a\x73\xcf\x65\x70"
"\x84\x62\xf5\x73\x73\x66\x75\xdf\xc4\xaf\x80\xc6\xe9\xa6\xdd\x80\xaa\x74\x61"
"\x69\x72\x73\x2e"); break;
  }
  ReturnOverlay1(0);
}

void PrintDesc_InflatedBoat(int desc_flag)
{
  if (desc_flag == 0)
    PrintCompText("\xd0\x6d\x61\x67\x69\x63\xb0\x6f\x61\x74");
  else
  {
    if (YouAreInBoat)
      PrintCompText("\x8b\xbb\x9e\x73\xc7\xf0\x9c\xa7\xa3\xee\x61\x67\x69\x63"
"\xb0\x6f\x61\x74\x2e");
    else
      PrintCompText("\x99\xa9\x87\xd0\x6d\x61\x67\x69\x63\xb0\x6f\xaf\xc0\xac\x65\x2e");
  }
  ReturnOverlay1(0);
}

void PrintDesc_Lamp(int desc_flag)
{
  char *name;

  if (Obj[O_LAMP].prop & PROP_LIT) name = "lit brass lantern"; else name = "brass lantern";

  if (desc_flag == 0)
    {PrintCompText("\x61\x20"); PrintText(name);}
  else
  {
    if (Obj[O_LAMP].prop & PROP_MOVEDDESC)
      {PrintCompText("\x99\xa9\x87\x61\x20"); PrintText(name); 
	PrintCompText("\x20\x28\x62\xaf\xd1\x72\x79\x2d\x70\xf2\xac\xd5\x29\xc0\xac\x65\x2e");}
    else
      PrintCompText("\x41\xb0\xaf\xd1\x72\x79\x2d\x70\xf2\xac\xd5\xb0\xf4\x73"
"\xa1\xfd\xe5\xac\xb4\x9a\xca\x80\x9f\xc2\x70\x68\xc4\xe7\x73\x65\x2e");
  }
  ReturnOverlay1(0);
}

void PrintDesc_Candles(int desc_flag)
{
  char *name;

  if (Obj[O_CANDLES].prop & PROP_LIT) name = "pair of burning candles"; else name = "pair of candles";

  if (desc_flag == 0)
    {PrintCompText("\x61\x20"); PrintText(name);}
  else
  {
    if (Obj[O_CANDLES].prop & PROP_MOVEDDESC)
      {PrintCompText("\x99\xa9\x87\x61\x20"); PrintText(name); PrintCompText("\xc0\xac\x65\x2e");}
    else
      PrintCompText("\x4f\xb4\x81\x74\x77\xba\xd4\x64\xa1\xdd\x80\xa3\x6c\x74"
"\xbb\xa3\xa9\xb0\xd8\x6e\x84\xe7\xb9\xcf\x73\x2e");
  }
  ReturnOverlay1(0);
}

/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/* function can call itself*/
int IsObjVisible(int obj)
{
  if (obj < 2 || obj >= NUM_OBJECTS) return 0;

  if (Obj[obj].prop & PROP_EVERYWHERE) 
	return 1; /* presence must be checked by calling function*/

  if (Obj[obj].loc == INSIDE + O_YOU) return 1;   /* obj is in your inventory*/
  if (Obj[obj].loc == Obj[O_YOU].loc) return 1; /* obj is in same room as you*/

  if (Obj[obj].loc >= INSIDE) /* obj is inside container*/
  {
    int container = Obj[obj].loc - INSIDE;

    if (Obj[container].prop & PROP_OPEN) /* container is open*/
      if (IsObjVisible(container)) return 1; /* yikes it's recursive*/
  }

  return 0;
}

